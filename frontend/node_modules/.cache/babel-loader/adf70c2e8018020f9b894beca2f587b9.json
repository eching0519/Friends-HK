{"ast":null,"code":"import React from 'react';\n\nconst querystring = require('querystring');\n\nconst LoginVerifier = async props => {\n  // return;\n  var msgUrl = querystring.encode({\n    smsg: '',\n    msg: \"Please login.\"\n  });\n\n  if (props.user === null) {\n    window.location.replace(\"/login\" + String.fromCharCode(63) + msgUrl);\n    return;\n  }\n\n  let myUser = JSON.parse(sessionStorage.getItem('UserProfile'));\n  let url = '/checkSession';\n  let res = await fetch(url, {\n    method: 'GET'\n  });\n  let data;\n\n  try {\n    data = await res.json();\n  } catch (error) {\n    msgUrl = querystring.encode({\n      smsg: 'Error!',\n      msg: \"Unexpected error. (\".concat(error.message, \")\")\n    });\n    window.location.replace(\"/login\" + String.fromCharCode(63) + msgUrl);\n    return;\n  }\n\n  const loginVerification = data.verification;\n\n  if (loginVerification) {\n    if (loginVerification.email !== myUser.email && loginVerification.verified) {\n      msgUrl = querystring.encode({\n        smsg: 'Sorry!',\n        msg: \"Session is invalid. Please login again.\"\n      });\n      window.location.replace(\"/login\" + String.fromCharCode(63) + msgUrl);\n      return;\n    }\n  }\n};\n\nexport default LoginVerifier;","map":{"version":3,"sources":["Z:\\3100project\\Friends-HK\\frontend\\src\\app\\component\\common\\LoginVerifier.js"],"names":["React","querystring","require","LoginVerifier","props","msgUrl","encode","smsg","msg","user","window","location","replace","String","fromCharCode","myUser","JSON","parse","sessionStorage","getItem","url","res","fetch","method","data","json","error","message","loginVerification","verification","email","verified"],"mappings":"AAAA,OAAOA,KAAP,MAAkB,OAAlB;;AACA,MAAMC,WAAW,GAAGC,OAAO,CAAC,aAAD,CAA3B;;AAEA,MAAMC,aAAa,GAAG,MAAOC,KAAP,IAAiB;AACnC;AACA,MAAIC,MAAM,GAAGJ,WAAW,CAACK,MAAZ,CAAmB;AAACC,IAAAA,IAAI,EAAC,EAAN;AAAUC,IAAAA,GAAG,EAAE;AAAf,GAAnB,CAAb;;AAEA,MAAIJ,KAAK,CAACK,IAAN,KAAe,IAAnB,EAAyB;AACrBC,IAAAA,MAAM,CAACC,QAAP,CAAgBC,OAAhB,CAAwB,WAAWC,MAAM,CAACC,YAAP,CAAoB,EAApB,CAAX,GAAqCT,MAA7D;AACA;AACH;;AAED,MAAIU,MAAM,GAAGC,IAAI,CAACC,KAAL,CAAWC,cAAc,CAACC,OAAf,CAAuB,aAAvB,CAAX,CAAb;AAEA,MAAIC,GAAG,GAAG,eAAV;AACE,MAAIC,GAAG,GAAG,MAAMC,KAAK,CAACF,GAAD,EAAM;AACvBG,IAAAA,MAAM,EAAE;AADe,GAAN,CAArB;AAIA,MAAIC,IAAJ;;AACA,MAAI;AACAA,IAAAA,IAAI,GAAG,MAAMH,GAAG,CAACI,IAAJ,EAAb;AACH,GAFD,CAEE,OAAOC,KAAP,EAAc;AACVrB,IAAAA,MAAM,GAAGJ,WAAW,CAACK,MAAZ,CAAmB;AAACC,MAAAA,IAAI,EAAC,QAAN;AAAgBC,MAAAA,GAAG,+BAAwBkB,KAAK,CAACC,OAA9B;AAAnB,KAAnB,CAAT;AACAjB,IAAAA,MAAM,CAACC,QAAP,CAAgBC,OAAhB,CAAwB,WAAWC,MAAM,CAACC,YAAP,CAAoB,EAApB,CAAX,GAAqCT,MAA7D;AACA;AACL;;AAED,QAAMuB,iBAAiB,GAAGJ,IAAI,CAACK,YAA/B;;AACA,MAAID,iBAAJ,EAAuB;AACnB,QAAIA,iBAAiB,CAACE,KAAlB,KAA4Bf,MAAM,CAACe,KAAnC,IAA4CF,iBAAiB,CAACG,QAAlE,EAA4E;AACtE1B,MAAAA,MAAM,GAAGJ,WAAW,CAACK,MAAZ,CAAmB;AAACC,QAAAA,IAAI,EAAC,QAAN;AAAgBC,QAAAA,GAAG;AAAnB,OAAnB,CAAT;AACAE,MAAAA,MAAM,CAACC,QAAP,CAAgBC,OAAhB,CAAwB,WAAWC,MAAM,CAACC,YAAP,CAAoB,EAApB,CAAX,GAAqCT,MAA7D;AACA;AACL;AACJ;AACN,CAjCD;;AAmCA,eAAeF,aAAf","sourcesContent":["import React from 'react';\r\nconst querystring = require('querystring');\r\n\r\nconst LoginVerifier = async (props) => {\r\n    // return;\r\n    var msgUrl = querystring.encode({smsg:'', msg: \"Please login.\"})\r\n\r\n    if (props.user === null) {\r\n        window.location.replace(\"/login\" + String.fromCharCode(63) + msgUrl);\r\n        return\r\n    }\r\n\r\n    let myUser = JSON.parse(sessionStorage.getItem('UserProfile'));\r\n    \r\n    let url = '/checkSession';\r\n      let res = await fetch(url, {\r\n          method: 'GET',\r\n      });\r\n\r\n      let data;\r\n      try {\r\n          data = await res.json();\r\n      } catch (error) {\r\n            msgUrl = querystring.encode({smsg:'Error!', msg: `Unexpected error. (${error.message})`})\r\n            window.location.replace(\"/login\" + String.fromCharCode(63) + msgUrl);\r\n            return\r\n      }\r\n\r\n      const loginVerification = data.verification;\r\n      if (loginVerification) {\r\n          if (loginVerification.email !== myUser.email && loginVerification.verified) {\r\n                msgUrl = querystring.encode({smsg:'Sorry!', msg: `Session is invalid. Please login again.`})\r\n                window.location.replace(\"/login\" + String.fromCharCode(63) + msgUrl);\r\n                return\r\n          }\r\n      }\r\n}\r\n\r\nexport default LoginVerifier;"]},"metadata":{},"sourceType":"module"}