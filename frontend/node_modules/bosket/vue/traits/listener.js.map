{"version":3,"sources":["../../../src/vue/traits/listener.js"],"names":["withListener","eventType","prop","mountOn","autoMount","regulate","name","Component","props","created","mount","beforeDestroy","unmount","beforeUpdate","$props","data","listening","ticking","callback","methods","subscribe","cb","onEvent","event","window","requestAnimationFrame","document","addEventListener","removeEventListener","render","listener"],"mappings":";;;;;;AAAA;;AAEA,OAAO,IAAMA,eAAe,SAAfA,YAAe;AAAA,8BACxBC,SADwB;AAAA,QACxBA,SADwB,kCACZ,OADY;AAAA,yBAExBC,IAFwB;AAAA,QAExBA,IAFwB,6BAEjB,UAFiB;AAAA,4BAGxBC,OAHwB;AAAA,QAGxBA,OAHwB,gCAGd,IAHc;AAAA,8BAIxBC,SAJwB;AAAA,QAIxBA,SAJwB,kCAIZ,KAJY;AAAA,6BAKxBC,QALwB;AAAA,QAKxBA,QALwB,iCAKb,KALa;AAAA,WAMtB;AAAA,eAAc;AAChBC,oCAAuBC,UAAUD,IADjB;AAEhBE,mBAAOD,UAAUC,KAAV,gCAAsBD,UAAUC,KAAhC,KAAyC,EAFhC;AAGhBC,mBAHgB,qBAGN;AACN,oBAAGL,SAAH,EAAc,KAAKM,KAAL,CAAW,IAAX;AACjB,aALe;AAMhBC,yBANgB,2BAMA;AACZ,qBAAKC,OAAL;AACH,aARe;AAShBC,wBATgB,0BASD;AACX,oBAAGV,OAAH,EAAYA,QAAQ,KAAKW,MAAb,IAAuB,KAAKJ,KAAL,CAAW,IAAX,CAAvB,GAA0C,KAAKE,OAAL,EAA1C;AACf,aAXe;;AAYhBG,kBAAM;AAAA,uBAAO;AACTC,+BAAW,KADF;AAETC,6BAAS,KAFA;AAGTC,8BAAU;AAHD,iBAAP;AAAA,aAZU;AAiBhBC,qBAAS;AACL;;AAEAC,yBAHK,qBAGKC,EAHL,EAGS;AAAE,yBAAKH,QAAL,GAAgBG,EAAhB;AAAoB,iBAH/B;AAILC,uBAJK,mBAIGC,KAJH,EAIU;AAAA;;AACX,wBAAG,KAAKL,QAAR,EAAkB;AACd,4BAAGb,QAAH,EAAa;AACT,gCAAG,CAAC,KAAKY,OAAT,EAAkB;AACd,oCAAMC,WAAW,KAAKA,QAAtB;AACAM,uCAAOC,qBAAP,CAA6B;AAAA,2CAAMP,SAASK,KAAT,EAAgB,YAAM;AAAE,8CAAKN,OAAL,GAAe,KAAf;AAAsB,qCAA9C,CAAN;AAAA,iCAA7B;AACH;AACD,iCAAKA,OAAL,GAAe,IAAf;AACH,yBAND,MAOI,KAAKC,QAAL,CAAcK,KAAd;AACP;AACJ,iBAfI;;;AAiBL;;AAEAb,qBAnBK,mBAmBG;AACJ,wBAAG,CAAC,KAAKM,SAAT,EAAoB;AAChBU,iCAASC,gBAAT,CAA0B1B,SAA1B,EAAqC,KAAKqB,OAA1C;AACA,6BAAKN,SAAL,GAAiB,IAAjB;AACH;AACJ,iBAxBI;AA0BLJ,uBA1BK,qBA0BK;AACN,wBAAG,KAAKI,SAAR,EAAmB;AACfU,iCAASE,mBAAT,CAA6B3B,SAA7B,EAAwC,KAAKqB,OAA7C;AACA,6BAAKN,SAAL,GAAiB,KAAjB;AACH;AACJ;AA/BI,aAjBO;AAkDhBa,kBAlDgB,oBAkDP;AAAA;;AACL,oBAAMC,+BACD5B,IADC,EACM;AACJkB,+BAAW,KAAKA,SADZ;AAEJV,2BAAW,KAAKA,KAFZ;AAGJE,6BAAW,KAAKA;AAHZ,iBADN,CAAN;AAOA,oBAAMJ,QAAQ;AACVA,wCAAY,KAAKM,MAAjB,EAA4BgB,QAA5B;AADU,iBAAd;AAGA,uBAAO;AAAC,6BAAD;AAAgBtB,yBAAhB;AAAA;AAAA,iBAAP;AACH;AA9De,SAAd;AAAA,KANsB;AAAA,CAArB","file":"listener.js","sourcesContent":["/* Adds a configurable global listener. */\n\nexport const withListener = ({\n    eventType = \"click\",\n    prop = \"listener\",\n    mountOn = null,\n    autoMount = false,\n    regulate = false\n}) => Component => ({\n    name: `withListener-${ Component.name }`,\n    props: Component.props ? [...Component.props] : [],\n    created() {\n        if(autoMount) this.mount(this)\n    },\n    beforeDestroy() {\n        this.unmount()\n    },\n    beforeUpdate() {\n        if(mountOn) mountOn(this.$props) ? this.mount(this) : this.unmount()\n    },\n    data: () => ({\n        listening: false,\n        ticking: false,\n        callback: null\n    }),\n    methods: {\n        /* Subscriptions */\n\n        subscribe(cb) { this.callback = cb },\n        onEvent(event) {\n            if(this.callback) {\n                if(regulate) {\n                    if(!this.ticking) {\n                        const callback = this.callback\n                        window.requestAnimationFrame(() => callback(event, () => { this.ticking = false }))\n                    }\n                    this.ticking = true\n                } else\n                    this.callback(event)\n            }\n        },\n\n        /* Events */\n\n        mount() {\n            if(!this.listening) {\n                document.addEventListener(eventType, this.onEvent)\n                this.listening = true\n            }\n        },\n\n        unmount() {\n            if(this.listening) {\n                document.removeEventListener(eventType, this.onEvent)\n                this.listening = false\n            }\n        }\n    },\n    render() {\n        const listener = {\n            [prop]: {\n                subscribe: this.subscribe,\n                mount:     this.mount,\n                unmount:   this.unmount\n            }\n        }\n        const props = {\n            props: { ...this.$props, ...listener }\n        }\n        return <Component { ...props } />\n    }\n})\n"]}