!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.ReactDnDTouchBackend=t():e.ReactDnDTouchBackend=t()}(window,(function(){return function(e){var t={};function o(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,o),s.l=!0,s.exports}return o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)o.d(n,s,function(t){return e[t]}.bind(null,s));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=1)}([function(e,t,o){"use strict";e.exports=function(e,t,o,n,s,i,r,a){if(!e){var h;if(void 0===t)h=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var d=[o,n,s,i,r,a],u=0;(h=new Error(t.replace(/%s/g,(function(){return d[u++]})))).name="Invariant Violation"}throw h.framesToPop=1,h}}},function(e,t,o){"use strict";o.r(t);var n,s=o(0),i=o.n(s);!function(e){e.mouse="mouse",e.touch="touch",e.keyboard="keyboard"}(n||(n={}));const r={Left:1,Right:2,Center:4},a={Left:0,Center:1,Right:2};function h(e){return void 0===e.button||e.button===a.Left}const d=1;function u(e){return function(e){return!!e.targetTouches}(e)?function(e){if(1===e.targetTouches.length)return u(e.targetTouches[0])}(e):{x:e.clientX,y:e.clientY}}var c=(()=>{let e=!1;try{addEventListener("test",()=>{},Object.defineProperty({},"passive",{get:()=>(e=!0,!0)}))}catch(e){}return e})();class l{constructor(e,t){this.enableTouchEvents=!0,this.enableMouseEvents=!1,this.enableKeyboardEvents=!1,this.ignoreContextMenu=!1,this.enableHoverOutsideTarget=!1,this.touchSlop=0,this.scrollAngleRanges=void 0,this.context=t,this.delayTouchStart=e.delayTouchStart||e.delay||0,this.delayMouseStart=e.delayMouseStart||e.delay||0,Object.keys(e).forEach(t=>{null!=e[t]&&(this[t]=e[t])})}get window(){return this.context&&this.context.window?this.context.window:"undefined"!=typeof window?window:void 0}get document(){if(this.window)return this.window.document}}const v={[n.mouse]:{start:"mousedown",move:"mousemove",end:"mouseup",contextmenu:"contextmenu"},[n.touch]:{start:"touchstart",move:"touchmove",end:"touchend"},[n.keyboard]:{keydown:"keydown"}};class p{constructor(e,t,o){this.getSourceClientOffset=e=>(function(e){const t=e.nodeType===d?e:e.parentElement;if(!t)return;const{top:o,left:n}=t.getBoundingClientRect();return{x:n,y:o}})(this.sourceNodes[e]),this.handleTopMoveStartCapture=e=>{h(e)&&(this.moveStartSourceIds=[])},this.handleMoveStart=e=>{Array.isArray(this.moveStartSourceIds)&&this.moveStartSourceIds.unshift(e)},this.handleTopMoveStart=e=>{if(!h(e))return;const t=u(e);t&&(this._mouseClientOffset=t),this.waitingForDelay=!1},this.handleTopMoveStartDelay=e=>{if(!h(e))return;const t=e.type===v.touch.start?this.options.delayTouchStart:this.options.delayMouseStart;this.timeout=setTimeout(this.handleTopMoveStart.bind(this,e),t),this.waitingForDelay=!0},this.handleTopMoveCapture=()=>{this.dragOverTargetIds=[]},this.handleMove=(e,t)=>{this.dragOverTargetIds&&this.dragOverTargetIds.unshift(t)},this.handleTopMove=e=>{if(this.timeout&&clearTimeout(this.timeout),!this.document||this.waitingForDelay)return;const{moveStartSourceIds:t,dragOverTargetIds:o}=this,n=this.options.enableHoverOutsideTarget,s=u(e);if(!s)return;if(this._isScrolling||!this.monitor.isDragging()&&function(e,t,o,n,s){if(!s)return!1;const i=180*Math.atan2(n-t,o-e)/Math.PI+180;for(let e=0;e<s.length;++e)if((null==s[e].start||i>=s[e].start)&&(null==s[e].end||i<=s[e].end))return!0;return!1}(this._mouseClientOffset.x||0,this._mouseClientOffset.y||0,s.x,s.y,this.options.scrollAngleRanges))return void(this._isScrolling=!0);if(!this.monitor.isDragging()&&this._mouseClientOffset.hasOwnProperty("x")&&t&&function(e,t,o,n){return Math.sqrt(Math.pow(Math.abs(o-e),2)+Math.pow(Math.abs(n-t),2))}(this._mouseClientOffset.x||0,this._mouseClientOffset.y||0,s.x,s.y)>(this.options.touchSlop?this.options.touchSlop:0)&&(this.moveStartSourceIds=void 0,this.actions.beginDrag(t,{clientOffset:this._mouseClientOffset,getSourceClientOffset:this.getSourceClientOffset,publishSource:!1})),!this.monitor.isDragging())return;const i=this.sourceNodes[this.monitor.getSourceId()];this.installSourceNodeRemovalObserver(i),this.actions.publishDragSource(),e.preventDefault();const r=(o||[]).map(e=>this.targetNodes[e]),a=this.options.getDropTargetElementsAtPoint?this.options.getDropTargetElementsAtPoint(s.x,s.y,r):this.document.elementsFromPoint(s.x,s.y),h=[];for(const e in a){if(!a.hasOwnProperty(e))continue;let t=a[e];for(h.push(t);t;)t=t.parentElement,-1===h.indexOf(t)&&h.push(t)}const d=h.filter(e=>r.indexOf(e)>-1).map(e=>{for(const t in this.targetNodes)if(e===this.targetNodes[t])return t}).filter(e=>!!e).filter((e,t,o)=>o.indexOf(e)===t);if(n)for(const e in this.targetNodes)if(this.targetNodes[e]&&this.targetNodes[e].contains(i)&&-1===d.indexOf(e)){d.unshift(e);break}d.reverse(),this.actions.hover(d,{clientOffset:s})},this.handleTopMoveEndCapture=e=>{this._isScrolling=!1,function(e){return void 0===e.buttons||0==(e.buttons&r.Left)}(e)&&(this.monitor.isDragging()&&!this.monitor.didDrop()?(e.preventDefault(),this._mouseClientOffset={},this.uninstallSourceNodeRemovalObserver(),this.actions.drop(),this.actions.endDrag()):this.moveStartSourceIds=void 0)},this.handleCancelOnEscape=e=>{"Escape"===e.key&&this.monitor.isDragging()&&(this._mouseClientOffset={},this.uninstallSourceNodeRemovalObserver(),this.actions.endDrag())},this.options=new l(o,t),this.actions=e.getActions(),this.monitor=e.getMonitor(),this.sourceNodes={},this.sourcePreviewNodes={},this.sourcePreviewNodeOptions={},this.targetNodes={},this.listenerTypes=[],this._mouseClientOffset={},this._isScrolling=!1,this.options.enableMouseEvents&&this.listenerTypes.push(n.mouse),this.options.enableTouchEvents&&this.listenerTypes.push(n.touch),this.options.enableKeyboardEvents&&this.listenerTypes.push(n.keyboard)}get window(){return this.options.window}get document(){if(this.window)return this.window.document}setup(){this.window&&(i()(!p.isSetUp,"Cannot have two Touch backends at the same time."),p.isSetUp=!0,this.addEventListener(this.window,"start",this.getTopMoveStartHandler()),this.addEventListener(this.window,"start",this.handleTopMoveStartCapture,!0),this.addEventListener(this.window,"move",this.handleTopMove),this.addEventListener(this.window,"move",this.handleTopMoveCapture,!0),this.addEventListener(this.window,"end",this.handleTopMoveEndCapture,!0),this.options.enableMouseEvents&&!this.options.ignoreContextMenu&&this.addEventListener(this.window,"contextmenu",this.handleTopMoveEndCapture),this.options.enableKeyboardEvents&&this.addEventListener(this.window,"keydown",this.handleCancelOnEscape,!0))}teardown(){this.window&&(p.isSetUp=!1,this._mouseClientOffset={},this.removeEventListener(this.window,"start",this.handleTopMoveStartCapture,!0),this.removeEventListener(this.window,"start",this.handleTopMoveStart),this.removeEventListener(this.window,"move",this.handleTopMoveCapture,!0),this.removeEventListener(this.window,"move",this.handleTopMove),this.removeEventListener(this.window,"end",this.handleTopMoveEndCapture,!0),this.options.enableMouseEvents&&!this.options.ignoreContextMenu&&this.removeEventListener(this.window,"contextmenu",this.handleTopMoveEndCapture),this.options.enableKeyboardEvents&&this.removeEventListener(this.window,"keydown",this.handleCancelOnEscape,!0),this.uninstallSourceNodeRemovalObserver())}addEventListener(e,t,o,n){const s=c?{capture:n,passive:!1}:n;this.listenerTypes.forEach((function(n){const i=v[n][t];i&&e.addEventListener(i,o,s)}))}removeEventListener(e,t,o,n){const s=c?{capture:n,passive:!1}:n;this.listenerTypes.forEach((function(n){const i=v[n][t];i&&e.removeEventListener(i,o,s)}))}connectDragSource(e,t){const o=this.handleMoveStart.bind(this,e);return this.sourceNodes[e]=t,this.addEventListener(t,"start",o),()=>{delete this.sourceNodes[e],this.removeEventListener(t,"start",o)}}connectDragPreview(e,t,o){return this.sourcePreviewNodeOptions[e]=o,this.sourcePreviewNodes[e]=t,()=>{delete this.sourcePreviewNodes[e],delete this.sourcePreviewNodeOptions[e]}}connectDropTarget(e,t){if(!this.document)return()=>null;const o=o=>{if(!this.document||!this.monitor.isDragging())return;let n;switch(o.type){case v.mouse.move:n={x:o.clientX,y:o.clientY};break;case v.touch.move:n={x:o.touches[0].clientX,y:o.touches[0].clientY}}const s=null!=n?this.document.elementFromPoint(n.x,n.y):void 0,i=s&&t.contains(s);return s===t||i?this.handleMove(o,e):void 0};return this.addEventListener(this.document.body,"move",o),this.targetNodes[e]=t,()=>{this.document&&(delete this.targetNodes[e],this.removeEventListener(this.document.body,"move",o))}}getTopMoveStartHandler(){return this.options.delayTouchStart||this.options.delayMouseStart?this.handleTopMoveStartDelay:this.handleTopMoveStart}installSourceNodeRemovalObserver(e){this.uninstallSourceNodeRemovalObserver(),this.draggedSourceNode=e,this.draggedSourceNodeRemovalObserver=new MutationObserver(()=>{e&&!e.parentElement&&(this.resurrectSourceNode(),this.uninstallSourceNodeRemovalObserver())}),e&&e.parentElement&&this.draggedSourceNodeRemovalObserver.observe(e.parentElement,{childList:!0})}resurrectSourceNode(){this.document&&this.draggedSourceNode&&(this.draggedSourceNode.style.display="none",this.draggedSourceNode.removeAttribute("data-reactid"),this.document.body.appendChild(this.draggedSourceNode))}uninstallSourceNodeRemovalObserver(){this.draggedSourceNodeRemovalObserver&&this.draggedSourceNodeRemovalObserver.disconnect(),this.draggedSourceNodeRemovalObserver=void 0,this.draggedSourceNode=void 0}}t.default=(e,t,o={})=>new p(e,t,o)}])}));